<div class="admin-page-container">
  <div class="admin-main-content">
    <div class="admin-container">
      <h1>Painel de Administra√ß√£o</h1>

      <div *ngIf="error" class="error-message">
        {{ error }}
      </div>

      <div *ngIf="successMessage" class="success-message">
        {{ successMessage }}
      </div>

      <div *ngIf="isAdmin" class="admin-panel">
        <div class="admin-section">
          <h2>Gerenciar Administradores</h2>

          <!-- Lista de administradores atuais -->
          <div class="admin-list-section">
            <h3>Administradores Atuais</h3>
            <div *ngIf="adminUsers.length > 0" class="admin-list">
              <div *ngFor="let admin of adminUsers" class="admin-item">
                <span class="admin-username">{{ admin.username }}</span>
                <span *ngIf="admin.isMainAdmin" class="admin-badge">Principal</span>
                <span *ngIf="admin.username === currentUsername && !admin.isMainAdmin" class="admin-badge">Voc√™</span>
              </div>
            </div>
            <p *ngIf="adminUsers.length === 0">N√£o h√° administradores cadastrados.</p>
          </div>

          <!-- Formul√°rio para promover usu√°rios -->
          <h3>Adicionar Administrador</h3>
          <p>Promova usu√°rios existentes a administradores.</p>

          <form [formGroup]="promoteForm" (ngSubmit)="onPromoteUser()" class="admin-form">
            <div class="form-group">
              <label for="username">Nome de Usu√°rio</label>
              <input
                type="text"
                formControlName="username"
                id="username"
                placeholder="Digite o nome do usu√°rio a promover"
                [disabled]="isSubmitting"
              >
              <div class="error-message" *ngIf="promoteForm.get('username')?.errors?.['required'] && promoteForm.get('username')?.touched">
                O nome de usu√°rio √© obrigat√≥rio
              </div>
            </div>

            <button
              type="submit"
              [disabled]="!promoteForm.valid || isSubmitting"
              class="submit-button"
            >
              {{ isSubmitting ? 'Promovendo...' : 'Promover a Administrador' }}
            </button>
          </form>
        </div>

        <!-- Se√ß√£o para remover privil√©gios de administrador -->
        <div class="admin-section">
          <h2>Remover Privil√©gios de Administrador</h2>
          <p>Remova privil√©gios de administrador de usu√°rios. N√£o √© poss√≠vel remover o administrador principal nem seus pr√≥prios privil√©gios.</p>

          <form [formGroup]="removeForm" (ngSubmit)="onRemoveAdmin()" class="admin-form">
            <div class="form-group">
              <label for="remove-username">Nome de Usu√°rio</label>
              <input
                type="text"
                formControlName="username"
                id="remove-username"
                placeholder="Digite o nome do usu√°rio a remover privil√©gios"
                [disabled]="isRemoveSubmitting"
              >
              <div class="error-message" *ngIf="removeForm.get('username')?.errors?.['required'] && removeForm.get('username')?.touched">
                O nome de usu√°rio √© obrigat√≥rio
              </div>
            </div>

            <button
              type="submit"
              [disabled]="!removeForm.valid || isRemoveSubmitting"
              class="submit-button remove-button"
            >
              {{ isRemoveSubmitting ? 'Removendo...' : 'Remover Privil√©gios' }}
            </button>
          </form>
        </div>

        <!-- Se√ß√£o para transferir t√≠tulo de administrador principal (apenas vis√≠vel para o admin principal) -->
        <div *ngIf="isMainAdmin" class="admin-section">
          <h2>Transferir T√≠tulo de Administrador Principal</h2>
          <p>Transfira o t√≠tulo de administrador principal para outro administrador. <strong>ATEN√á√ÉO:</strong> Ap√≥s a transfer√™ncia, seu nome de usu√°rio ser√° alterado e voc√™ precisar√° fazer login novamente.</p>

          <form [formGroup]="transferForm" (ngSubmit)="onTransferMainAdmin()" class="admin-form">
            <div class="form-group">
              <label for="transfer-username">Nome de Usu√°rio do Novo Admin Principal</label>
              <input
                type="text"
                formControlName="username"
                id="transfer-username"
                placeholder="Digite o nome do usu√°rio que receber√° o t√≠tulo"
                [disabled]="isTransferSubmitting"
              >
              <div class="error-message" *ngIf="transferForm.get('username')?.errors?.['required'] && transferForm.get('username')?.touched">
                O nome de usu√°rio √© obrigat√≥rio
              </div>
            </div>

            <button
              type="submit"
              [disabled]="!transferForm.valid || isTransferSubmitting"
              class="submit-button transfer-button"
            >
              {{ isTransferSubmitting ? 'Transferindo...' : 'Transferir T√≠tulo' }}
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Se√ß√£o lateral para listar todos os usu√°rios -->
  <div *ngIf="isAdmin" class="users-sidebar">
    <div class="sidebar-header">
      <h2>Lista de Usu√°rios</h2>

      <form [formGroup]="searchForm" class="search-form">
        <input
          type="text"
          formControlName="search"
          placeholder="Pesquisar usu√°rios..."
          class="search-input"
        >
      </form>
    </div>

    <div class="users-list-container">
      <div *ngIf="isLoadingUsers" class="loading-spinner">
        Carregando...
      </div>

      <div *ngIf="!isLoadingUsers && filteredUsers.length === 0" class="no-users-found">
        <p>Nenhum usu√°rio encontrado</p>
      </div>

      <div *ngIf="!isLoadingUsers" class="users-list">
        <div *ngFor="let user of filteredUsers" class="user-item">
          <div class="user-info">
            <span class="user-name">{{ user.username }}</span>
            <div class="user-badges">
              <span *ngIf="user.isAdmin" class="user-badge admin-badge">Admin</span>
              <span *ngIf="user.isMainAdmin" class="user-badge main-admin-badge">Principal</span>
            </div>
          </div>
          <div class="contact-info">
            <div *ngIf="user.email" class="contact-detail">
              <span class="contact-icon">‚úâÔ∏è</span>
              <span class="contact-value">{{ user.email }}</span>
            </div>
            <div *ngIf="user.phone" class="contact-detail">
              <span class="contact-icon">üìû</span>
              <span class="contact-value">{{ user.phone }}</span>
            </div>
            <div *ngIf="!user.email && !user.phone" class="no-contact-info">
              <em>Sem informa√ß√µes de contato</em>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
